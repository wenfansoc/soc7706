---
title: "Lagged dependent variable and change score models"
author: "Wen Fan"
date: "2025-09-03"
output: html_document
---


The research question we address is: Does general happiness predict work hours? The data set we will use comes from the General Social Surveys 2010 Panel, which can be downloaded [here](https://gss.norc.org/us/en/gss/get-the-data/stata.html)---titled “GSS Panel 2010–Sample Wave 3 (Release 6, March 2018)” in the “Panel Data Sets” section. For the purpose of this week, we will restrict our analyses to the first two waves.

### Install and load R packages

First, load the necessary libraries and the data.

```{r message=FALSE}
#install.packages(c('tidyverse', 'haven', 'corrplot', 'sjPlot', 'lavaan'))
library(tidyverse)
library(haven)
library(corrplot)
library(sjPlot)
library(lavaan)
```
%>%
```{r}
gss <- read_dta("/Users/wenfan/Library/CloudStorage/Dropbox/Longitudinal Data/GSS_panel2010w123_R6 - stata.dta")
```

### Descriptive analysis

Let's take a look at the summary statistics for happiness and work hours, the first 10 rows of data to get a sense of its structure, and the correlation matrix and plot between variables.

Do the means and standard deviations look reasonable? How correlated are the Wave 1 and Wave 2 measures? Are there strong correlations between the predictor and the outcome?

```{r}
# Data cleaning
gss$happy_1 <- 4 - gss$happy_1
gss$happy_2 <- 4 - gss$happy_2

# Summary statistics
gss |> select("happy_1", "happy_2", "hrs1_1", "hrs1_2") |> summary()

# First 10 rows of data
head(gss[, c("happy_1", "happy_2", "hrs1_1", "hrs1_2")], 10)

# Correlation matrix
(cor_matrix <- gss |> select("happy_1", "happy_2", "hrs1_1", "hrs1_2") |> cor(use = "complete.obs"))
```

```{r}
# Correlation plot
corrplot(cor_matrix, method = "color", type = "upper",
         title = "Correlation Matrix", mar = c(0, 0, 1, 0))
```

### Lagged dependent variable model

Does general happiness at Wave 1 predict work hours at Wave 2, controlling for work hours?

How should we interpret the coefficients for the lagged dependent variable (LDV) and general happiness? How much of the variance is explained?

```{r}
# Basic LDV model
ldv1 <- lm(hrs1_2 ~ hrs1_1 + happy_1, data = gss)
summary(ldv1)

# Calculate change in R-squared after adding baseline happiness
base <- lm(hrs1_2 ~ hrs1_1, data = gss)
summary(base)
r2_change <- summary(ldv1)$r.squared - summary(base)$r.squared
cat("R-squared change from adding happiness:", round(r2_change, 4))
```

We can continue adding other covariates.

```{r}
ldv2 <- update(ldv1, . ~ . + factor(race_1))
summary(ldv2)
```

Let's then fit a cross-lagged panel model. Note that happiness is not a continuous variable, so strictly speaking, OLS is not the best model. I am using it here for simplicity.

The model fits perfectly (CFI = 1.000, RMSEA = 0.000) because it is saturated. It has 0 degrees of freedom, meaning it uses all available information and cannot be wrong.

What do we conclude? Work hours and happiness do not predict each other over time in this sample. Both variables show similar persistence ($~50\%$), suggesting room for change over time.

```{r}
# Model specification
clpm_model <- '
  # Cross-lagged effects
  hrs1_2 ~ cross_happy*happy_1 + stable_hrs * hrs1_1
  happy_2 ~ cross_hrs*hrs1_1 + stable_happy * happy_1
  
  # Correlations at W1: "~~" correlation/covariance
  hrs1_1 ~~ happy_1
  
  # Correlated residuals at W2: after accounting for W1 predictors, W2 variables might still be related due to unmeasured factors
  hrs1_2 ~~ happy_2
  
  # Means (intercepts): "~ 1" estimates the intercept/mean, usually included for completeness
  hrs1_2 ~ 1
  happy_2 ~ 1
'

# Fit the model
clpm_fit <- sem(clpm_model, data = gss)

# Display results
summary(clpm_fit, fit.measures = TRUE, standardized = TRUE)
```

### Change score model

What predicts the amount of change in work hours?

How should we interpret the coefficient for happiness? How much of the variance in change is explained?

```{r}
# Basic change score model
gss$change_wh <- gss$hrs1_2 - gss$hrs1_1
cs1 <- lm(change_wh ~ happy_1, data = gss)

summary(cs1)
```

Note the mathematical equivalence to the LDV model if we include a lagged dependent variable in the change score model--pay attention to the predictor coefficients.

```{r}
# What if we add the lagged dependent variable?
cs2 <- update(cs1, . ~ . + hrs1_1)

summary(cs2)
tab_model(ldv1, cs2)
```

Diagnostic plots for both models---check for patterns that might indicate issues with model fit or assumptions.

```{r}
par(mfrow = c(2, 2))

# Residuals vs fitted for LDV model
plot(ldv1, which = 1, main = "LDV: Residuals vs Fitted")
plot(ldv1, which = 2, main = "LDV: Q-Q Plot")

# Residuals vs fitted for change score model
plot(cs1, which = 1, main = "Change Score: Residuals vs Fitted")
plot(cs1, which = 2, main = "Change Score: Q-Q Plot")
```