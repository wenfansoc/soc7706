---
title: "Lagged dependent variable and change score models"
author: "Wen Fan"
date: "2025-09-03"
output: html_document
---


The research question we address is: Does job insecurity predict general happiness? The data set we will use comes from the General Social Surveys 2010 Panel, which can be downloaded [here](https://gss.norc.org/us/en/gss/get-the-data/stata.html)--titled “GSS Panel 2010–Sample Wave 3 (Release 6, March 2018)” in the “Panel Data Sets” section. For the purpose of this week, we will restrict our analyses to the first two waves.

### Install and load R packages

First, load the necessary libraries and the data.

```{r message=FALSE}
#install.packages(c('tidyverse', 'haven', 'corrplot', 'sjPlot'))
library(tidyverse)
library(haven)
library(corrplot)
library(sjPlot)
```
%>%
```{r}
gss <- read_dta("/Users/wenfan/Library/CloudStorage/Dropbox/Longitudinal Data/GSS_panel2010w123_R6 - stata.dta")
```

### Descriptive analysis

Let's take a look at the summary statistics for job insecurity and happiness, the first 10 rows of data to get a sense of its structure, and the correlation matrix and plot between variables.

Do the means and standard deviations look reasonable? How correlated are the Wave 1 and Wave 2 measures? Are there strong correlations between the predictor and the outcome?

```{r}
# Data cleaning
gss$joblose_1 <- 5 - gss$joblose_1
gss$joblose_2 <- 5 - gss$joblose_2
gss$happy_1 <- 4 - gss$happy_1
gss$happy_2 <- 4 - gss$happy_2

# Summary statistics
gss |> select("joblose_1", "joblose_2", "happy_1", "happy_2") |> summary()

# First 10 rows of data
head(gss[, c("joblose_1", "joblose_2", "happy_1", "happy_2")], 10)

# Correlation matrix
(cor_matrix <- gss |> select("joblose_1", "joblose_2", "happy_1", "happy_2") |> cor(use = "complete.obs"))
```

```{r}
# Correlation plot
corrplot(cor_matrix, method = "color", type = "upper",
         title = "Correlation Matrix", mar = c(0, 0, 1, 0))
```

### Lagged dependent variable model

Does job insecurity at Wave 1 predict general happiness at Wave 2, controlling for baseline happiness? Note that happiness is not a continuous variable, so strictly speaking, OLS is not the best model. I am using it here for simplicity.

How should we interpret the coefficients for the lagged dependent variable (LDV) and job insecurity? How much of the variance is explained?

```{r}
# Basic LDV model
ldv1 <- lm(happy_2 ~ joblose_1 + happy_1, data = gss)
summary(ldv1)

# Calculate change in R-squared after adding baseline job insecurity
base <- lm(happy_2 ~ happy_1, data = gss)
r2_change <- summary(ldv1)$r.squared - summary(base)$r.squared
cat("R-squared change from adding job insecurity:", round(r2_change, 3))
```

We can continue adding other covariates.

```{r}
ldv2 <- update(ldv1, . ~ . + factor(race_1))
summary(ldv2)
```

### Change score model

What predicts the amount of change in general happiness?

How should we interpret the coefficient for job insecurity? How much of the variance in change is explained?

```{r}
# Basic change score model
gss$change_happy <- gss$happy_2 - gss$happy_1
cs1 <- lm(change_happy ~ joblose_1, data = gss)

summary(cs1)
```

Note the mathematical equivalence to the LDV model if we include a lagged dependent variable in the change score model--pay attention to the predictor coefficients.

```{r}
# What if we add the lagged dependent variable?
cs2 <- update(cs1, . ~ . + happy_1)

summary(cs2)
tab_model(ldv1, cs2)
```

Diagnostic plots for both models--check for patterns that might indicate issues with model fit or assumptions.

```{r}
par(mfrow = c(2, 2))

# Residuals vs fitted for LDV model
plot(ldv1, which = 1, main = "LDV: Residuals vs Fitted")
plot(ldv1, which = 2, main = "LDV: Q-Q Plot")

# Residuals vs fitted for change score model
plot(cs1, which = 1, main = "Change Score: Residuals vs Fitted")
plot(cs1, which = 2, main = "Change Score: Q-Q Plot")
```